---
title: "LAB_5_analisis_de_sentimientos"
author: "Francisco Rosal, Luca Rivera, Jose Block"
output: html_document
date: "8/29/2021"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Laboratorio 5. 
## Analisis de sentimientos

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(readr)
if (!require("tm"))    {install.packages("tm");   library("tm")}
if (!require("dplyr"))    {install.packages("dplyr");   library("dplyr")}
if (!require("tidytext"))    {install.packages("tidytext");   library("tidytext")}
if (!require("plotly"))    {install.packages("plotly");   library("plotly")}
if (!require("stringr"))    {install.packages("stringr");   library("stringr")}
if (!require("xml2"))    {install.packages("xml2");   library("xml2")}
if (!require("SnowballC"))    {install.packages("SnowballC");   library("SnowballC")}
if (!require("wordcloud"))    {install.packages("wordcloud");   library("wordcloud")}
if (!require("wordcloud2"))    {install.packages("wordcloud2");   library("wordcloud2")}
if (!require("RColorBrewer"))    {install.packages("RColorBrewer");   library("RColorBrewer")}
if (!require("stylo"))    {install.packages("stylo");   library("stylo")}
if (!require("SentimentAnalysis"))    {install.packages("SentimentAnalysis");   library("SentimentAnalysis")}
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
GrammarandProductReviews <- read_csv("./GrammarandProductReviews.csv")
```
Cuenta de NA's por columna:
```{r echo=FALSE, message=FALSE, warning=FALSE}
sapply(GrammarandProductReviews, function(x) sum(is.na(x)))
```

Se eliminarán las columnas:

- id: por cadencia de información.

- reviews.userProvince: por alta cantidad de NA.

- review.userCity: por alta cantidad de NA.

- reviews.id: por cadencia de información y cantidad de NA.

- reviews.didPurchase: por cantidad de NA - - - - - - - - - - - - - - - - - - - - - - -> (Podria ser importante)

- reviews.numHelpful:por cadencia de información y cantidad de NA.

- keys: por cadencia de información.

- dates, no se hará nada con fechas.
```{r echo=FALSE, message=FALSE, warning=FALSE}
df <- subset(GrammarandProductReviews, select = -c(1, 4, 5, 6, 7, 11, 12, 13, 14, 16, 17, 19, 22, 23))
```

Convertir el texto a mayúsculas o a minúsculas

Quitar los caracteres especiales que aparecen como “#”,”@” o los apóstrofes.

Quitar las url

Revisar si hay emoticones y quitarlos(a menos que le den información)

Quitar los signos de puntuación

Quitar los artículos, preposiciones y conjunciones (stopwords)

Quitar números si considera que interferirán en las predicciones.

```{r echo=FALSE, message=FALSE, warning=FALSE}
colnames(df)
df$reviews.text  <- str_replace_all(df$reviews.text, "[[:punct:]]", " ")
df$reviews.title <- str_replace_all(df$reviews.title, "[[:punct:]]", " ")
df$reviews.text  <- tolower(df$reviews.text)
df$reviews.title <- tolower(df$reviews.title)
df$reviews.text <- gsub('\\p{So}|\\p{Cn}', '', df$reviews.text, perl = TRUE)
df$reviews.title <- gsub('\\p{So}|\\p{Cn}', '', df$reviews.title, perl = TRUE)
df$reviews.text <- gsub('[0-9]+', '', df$reviews.text, perl = TRUE)
df$reviews.title <- gsub('[0-9]+', '', df$reviews.title, perl = TRUE)

stopwords_regex = paste(stopwords('en'), collapse = '\\b|\\b')
stopwords_regex = paste0('\\b', stopwords_regex, '\\b')
df$reviews.text = stringr::str_replace_all(df$reviews.text, stopwords_regex, '')
head(df$reviews.title)
df$reviews.title = stringr::str_replace_all(df$reviews.title, stopwords_regex, '')
head(df$reviews.text)
```

## Análisis Exploratorio

Top 20 frecuencia de palabras:
```{r echo=FALSE, message=FALSE, warning=FALSE}
dfsplit <- strsplit(df$reviews.text, "\\W")
dfunlist <- unlist(dfsplit)
freq <-table(dfunlist)
freq<-sort(freq, decreasing=TRUE)
head(freq, n = 20)

```
# Nube de frecuencia de palabras :
```{r echo=FALSE, message=FALSE, warning=FALSE}
wordcloud2(data=freq, size=32, color='random-dark')
```

#HIstograma

```{r echo=FALSE, message=FALSE, warning=FALSE}
freq = freq[-1]
frequ <- head(freq)
fig <- plot_ly(x = ~names(frequ),y = as.numeric(frequ), type = "bar")
fig
```



#Discusion sobre las palabras de mayor presencia:

Se notó que las palabras que mas se repiten en los reviews hacen referencia al producto y a que hay una tendencia a que sea bueno el producto. Se nota tambien cómo han servido las promociones que han hecho, ya que hablan mucho de ello.

#Determinación de las palabras positivas y negativas

```{r echo=FALSE}
prince_tidy <- df %>%
  unnest_tokens(word, reviews.text) %>% #Break the lyrics into individual words
  #filter(!word %in% undesirable_words) %>% #Remove undesirables
  #filter(!nchar(word) < 3) %>% #Words like "ah" or "oo" used in music
  anti_join(stop_words)
```
```{r}
bing_word_counts <- prince_tidy %>%
  inner_join(get_sentiments("bing")) %>%
  count(word, sentiment, sort = TRUE) %>%
  ungroup()
bing_word_counts
```

